# COMETの仕様
https://www.jitec.ipa.go.jp/1_13download/hani.pdf

# ハードウェアCOMETの仕様

## 1ワードのビット構成
- 1ワード16ビット
- アクセス可能なアドレス：0番地から65535番地まで

## 数値の仕様
- 2の補数表現

## 制御方式
- 逐次制御方式（⇒CPUが命令を順番に逐次実行する方式）
- 命令語は2ワード

# レジスタの仕様
汎用レジスタ・プログラムカウンタ・フラグレジスタの3種類が存在

## 汎用レジスタ（全て16bit）
- 汎用レジスタGR0：命令実行時に利用する
- 汎用レジスタGR1：命令実行時およびインデックスレジスタとして利用する
- 汎用レジスタGR2：命令実行時およびインデックスレジスタとして利用する
- 汎用レジスタGR3：命令実行時およびインデックスレジスタとして利用する
- 汎用レジスタGR4：スタックポインタとして利用する

## フラグレジスタ
- GRのデータが「負」ならばフラグレジスタは「10」
- GRのデータが「零」ならばフラグレジスタは「01」
- GRのデータが「正」ならばフラグレジスタは「00」

# 命令の仕様
- 命令語は全て固定長の2ワード
- 各命令中の[]は省略可能

## 命令語のフィールド
- OPフィールド(8bit)、GRフィールド(4bit)、XRフィールド(4bit)、ADDRフィールド(16bit)
- OPフィールドは命令の種類を表すオペコード。全23種。
- GRフィールドは演算で使用するGRの番号を指定。分岐命令・スタック命令においては参照されない。
- XRフィールドはアドレス修飾を行うGRの番号を指定
- ADDRフィールドは処理対象のアドレスが指定され、このアドレスにXRフィールドの値をアドレス修飾を施したものが実行アドレスとなる

## ロード・ストア命令
```
ロード：LD GR, adr[, XR]
```
- （有効アドレス）をGRアドレスに設定する

```
ストア：ST GR, adr［,XR］
```
- （GR）アドレスが示す番地に格納する

## ロードアドレス命令
```
ロードアドレス：LEA GR, adr［,XR］
```
- 有効アドレスをGRに設定する
- GRの値によってFRを設定する

## 論理算術命令
```
算術加算: ADD GR, adr [,XR]
算術減算: SUB GR, adr [,XR]
論理積: AND GR, adr [,XR]
論理和: OR GR, adr [,XR]
排他的論理和: EOR GR, adr [,XR]
```

- （GR）と（有効アドレス）に，指定した演算を施し，結果をGRに設定する。
- なお，算術減算では，（GR）から（有効アドレス）を減算する。
- 演算結果によってFRを設定する。

## 比較演算命令

## シフト演算命令
```
算術左シフト: SLA GR, adr [,XR]
算術右シフト: SRA GR, adr [,XR]
```

- (GR)を符号を除き有効アドレスで指定したビット数だけ左又は右にシフトする。
- シフトの結果，空いたビット位置には，左シフトのときは0，右シフトのときは符号と同じものが入る。
- シフトの結果によってFRを設定する。

```
論理左シフト: SLL GR, adr [,XR]
論理右シフト: SRL GR, adr [,XR]
```

- (GR)を符号を含み有効アドレスで指定したビット数だけ左又は右にシフトする。
- シフトの結果，空いたビット位置には0が入る。
- シフトの結果によってFRを設定する。

## 分岐命令
```
正分岐: JPZ adr [,XR]
負分岐: JMI adr [,XR]
非零分岐: JNZ adr [,XR]
零分岐: JZE adr [,XR]
無条件分岐: JMP adr [,XR]
```

- 無条件分岐以外:FRの値によって有効アドレスに分岐する。分岐しない場合は次の命令に進む。
- 無条件分岐:無条件に有効アドレスに分岐する。

## スタック操作命令
```
プッシュ: PUSH adr [,XR]
ポップ: POP GR
```
- プッシュ:SPから1アドレス減算した後、有効アドレスを（SP）番地に格納する
- ポップ:（SP）番地の内容をGRに設定した後、SPに1アドレス加算する。

## コール命令
```
コール: CALL adr [,XR]
```
- SPから1をアドレス減算した後，PCの現在値に2をアドレス加算した値を（SP）番地に格納し，有効アドレスに分岐する。

## リターン命令
```
リターン: RET
```
- （SP）番地の内容を取り出した後SPに1をアドレス加算し，先に取り出した内容（番地）に分岐する（取り出した内容をPCに設定する）。

```
; ハノイの塔を解くプログラム
MAIN   START
       LD      GR0,N
       LD      GR1,A
       LD      GR2,B
       LD      GR3,C
       CALL    HANOI       ; hanoi(3, A, B, C)
       RET
```
# データの仕様
- データは「算術データ」「論理データ」「文字データ」の3種類からなる
- データは全てワード単位からなる

## 論理データの仕様
- 符号なし整数

## 文字の仕様
- JISX0201規格
